<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>フロア移動・建物間移動の仕組み</title>
  <style>
    p {
      white-space : pre;
    }
  </style>
</head>
<body>
  <h1>フロア移動・建物間移動の仕組み</h1>

<h2>基本要素</h2>
<p>$D5EE ダンジョンキー1
$D5EC ダンジョンキー2

ダンジョンキー1,ダンジョンキー2とXY座標でフロア移動の行き先が決まる。</p>

<h2>フロア移動・建物間移動の処理</h2>
<p>アドレス$C3A923にあるテーブルが使用される。
このテーブルは8バイトのレコードからなる。
レコードの形式は次の通り。

[ダンジョンキー1] [ダンジョンキー2] [X座標] [Y座標] [ダンジョンキー1] [ダンジョンキー2] [X座標] [Y座標]

前の4バイトが移動元を、後の4バイトが移動先を表す。
すなわちフロア移動・建物間移動は、現在のダンジョンキーと座標が前半4バイトと一致するレコードを見つけ、
そのレコードの後半4バイトによって表される場所に移動する処理となる。
ただし、X,Y座標がFFのレコードは座標の判定をスキップしダンジョンキーのみのマッチとなる。

マッチするレコードが無い場合、ダンジョンキー1はそのままでダンジョンキー2を+1する。</p>

<p><a href="transitions.html">遷移リスト</a></p>
</body>
</html>
